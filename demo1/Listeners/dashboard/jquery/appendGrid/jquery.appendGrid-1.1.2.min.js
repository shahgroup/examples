/*!
* jQuery appendGrid v1.1.2
* https://appendgrid.apphb.com/
*
* Copyright 2013 Albert L.
* Dual licensed under the GPL (http://www.gnu.org/licenses/gpl.html)
* and MIT (http://www.opensource.org/licenses/mit-license.php) licenses.
*
* Depends:
* jQuery v1.9.1+
* jquery UI v1.10.2+
*/
(function(e){var m={caption:null,initRows:3,initData:null,firstCellWidth:32,lastCellWidth:89,columns:null,i18n:null,idPrefix:null,dataLoaded:null,afterRowAppended:null,afterRowInserted:null,afterRowSwapped:null,beforeRowRemove:null,afterRowRemoved:null,_uniqueIndex:0,_rowOrder:null,_isDataLoaded:false,_visibleCount:0};var o={type:"text",name:null,value:null,display:null,displayCss:null,cellCss:null,ctrlAttr:null,ctrlProp:null,ctrlCss:null,ctrlClass:null,ctrlOptions:null,uiOption:null,uiTooltip:null,customBuilder:null,customGetter:null,customSetter:null,onClick:null,onChange:null};var j={append:"Append Row",removeLast:"Remove Last Row",insert:"Insert Row Above",remove:"Remove Current Row",moveUp:"Move Up",moveDown:"Move Down"};var i={init:function(D){var A=this;var y,s,C,u,w,t;if(A.length>0){if(!e.isArray(D.columns)||D.columns.length==0){alert("Cannot initial grid without column information!");return A}y=A[0];if(k(y.tagName)||y.tagName!="TABLE"){alert("Cannot initial grid on element other than TABLE!");return A}var v=e.extend({},m,D);if(e.isPlainObject(D.textResources)){v.textResources=e.extend({},j)}else{v.textResources=e.extend({},j,D.textResources)}v._rowOrder=[];if(k(v.idPrefix)){if(k(y.id)||y.id==""){v.idPrefix="ag"+new Date().getTime()}else{v.idPrefix=y.id}}s=document.createElement("thead");s.className="ui-widget-header";C=document.createElement("tbody");C.className="ui-widget-content";u=document.createElement("tfoot");u.className="ui-widget-header";e(y).empty().addClass("appendGrid").addClass("ui-widget").append(s,C,u);v._visibleCount=0;w=s.insertRow(-1);t=w.insertCell(-1);t.className="ui-widget-header";e(t).width(v.firstCellWidth);for(var B=0;B<v.columns.length;B++){var x=e.extend({},o,v.columns[B]);v.columns[B]=x;if(v.columns[B].type!="hidden"){v._visibleCount++;t=w.insertCell(-1);t.className="ui-widget-header";e(t).text(v.columns[B].display);if(v.columns[B].displayCss){e(t).css(v.columns[B].displayCss)}}}t=w.insertCell(-1);t.className="ui-widget-header";e(t).width(v.lastCellWidth);if(v.caption){w=s.insertRow(0);t=w.insertCell(-1);t.className="ui-state-active caption";t.colSpan=v._visibleCount+2;e(t).text(v.caption)}w=u.insertRow(-1);t=w.insertCell(-1);t.colSpan=v._visibleCount+2;e(t).append(e("<input/>").attr({type:"hidden",id:v.idPrefix+"_rowOrder",name:v.idPrefix+"_rowOrder"}).addClass("row-order"));e(t).append(e("<button/>").attr({type:"button",title:v.textResources.append}).button({icons:{primary:"ui-icon-plusthick"},text:false}).click(function(){d(y,1,null,null)}));e(t).append(e("<button/>").attr({type:"button",title:v.textResources.removeLast}).button({icons:{primary:"ui-icon-closethick"},text:false}).click(function(){g(y,null,this.value,false)}));e(y).data("appendGrid",v);if(e.isArray(D.initData)){a(y,D.initData,true)}else{e(y).appendGrid("appendRow",v.initRows)}}return A},isReady:function(){var u=this,s=false;if(u.length>0){var t=u.first().data("appendGrid");if(t){s=true}}return s},isDataLoaded:function(){var u=this,s=null;if(this.length==1){var t=u.data("appendGrid");if(t){return t._isDataLoaded}else{return false}}else{return false}},load:function(s){var t=this;if(t.length>0){a(t[0],s,false)}return t},appendRow:function(s){return this.appendGrid("insertRow",s)},insertRow:function(v,z,t){var y=this;if(y.length>0){var s=y[0],x=null;var w=e(s).data("appendGrid");if(!w){alert("`appendGrid` does not initialized")}else{x=d(s,v||1,z,t);if(e.isNumeric(z)||e.isNumeric(t)){n(s,x.rowIndex);var u=w._rowOrder[x.addedRows[0]];e("#"+w.idPrefix+"_Insert_"+u,s).focus()}}}return y},removeRow:function(y,x){var w=this,z=-1;if(w.length>0){var v=w[0],s,A,u;var t=e(v).data("appendGrid");if(!t){alert("`appendGrid` does not initialized")}else{if(t._rowOrder.length>0){g(v,y,x,true)}}}return w},moveUpRow:function(y,x){var w=this,z=-1;if(w.length>0){var v=w[0],C,B,s,u;var t=e(v).data("appendGrid");if(!t){alert("`appendGrid` does not initialized")}else{var A=null;C=v.getElementsByTagName("tbody")[0];if(e.isNumeric(y)&&y>0&&y<t._rowOrder.length){A=y;x=t._rowOrder[y];B=document.getElementById(t.idPrefix+"_Row_"+x,v)}else{if(e.isNumeric(x)){A=f(x,t);B=document.getElementById(t.idPrefix+"_Row_"+x,v)}}if(A!=null&&A>0){s=document.getElementById(t.idPrefix+"_Row_"+t._rowOrder[A-1],v);C.removeChild(B);C.insertBefore(B,s);t._rowOrder[A]=t._rowOrder[A-1];t._rowOrder[A-1]=x;u=e("td.first",s).html();e("td.first",s).html(e("td.first",B).html());e("td.first",B).html(u);b(v,t);e("td.last button.moveUp",B).removeClass("ui-state-hover").blur();e("td.last button.moveUp",s).focus();if(t.afterRowSwapped){t.afterRowSwapped(v,A,A-1)}}}}return w},moveDownRow:function(y,x){var w=this,z=-1;if(w.length>0){var v=w[0],C,B,s,u;var t=e(v).data("appendGrid");if(!t){alert("`appendGrid` does not initialized")}else{var A=null;C=v.getElementsByTagName("tbody")[0];if(e.isNumeric(y)&&y>=0&&y<t._rowOrder.length-1){A=y;x=t._rowOrder[y];B=document.getElementById(t.idPrefix+"_Row_"+x,v)}else{if(e.isNumeric(x)){A=f(x,t);B=document.getElementById(t.idPrefix+"_Row_"+x,v)}}if(A!=null&&A!=t._rowOrder.length-1){s=document.getElementById(t.idPrefix+"_Row_"+t._rowOrder[A+1],v);C.removeChild(s);C.insertBefore(s,B);t._rowOrder[A]=t._rowOrder[A+1];t._rowOrder[A+1]=x;u=e("td.first",s).html();e("td.first",s).html(e("td.first",B).html());e("td.first",B).html(u);b(v,t);e("td.last button.moveDown",B).removeClass("ui-state-hover").blur();e("td.last button.moveDown",s).focus();if(t.afterRowSwapped){t.afterRowSwapped(v,A,A+1)}}}}return w},getRowCount:function(){var t=this;if(t.length>0){var s=t.data("appendGrid");if(s){return s._rowOrder.length}else{alert("`appendGrid` does not initialized")}}else{alert("Cannot get values on multiple grid")}return null},getUniqueIndex:function(u){var t=this;if(t.length>0&&u>=0){var s=t.data("appendGrid");if(s){if(u<s._rowOrder.length){return s._rowOrder[u]}}else{alert("`appendGrid` does not initialized")}}return null},getRowIndex:function(s){var u=this;if(u.length>0){var t=u.data("appendGrid");if(t){for(var v=0;v<t._rowOrder.length;v++){if(t._rowOrder[v]==s){return v}}return null}else{alert("`appendGrid` does not initialized")}}return null},getRowValue:function(x,t,w){var v=this,s=null;if(v.length>0){var u=v.data("appendGrid");if(u){if(e.isNumeric(x)&&x>=0&&x<u._rowOrder.length){t=u._rowOrder[x]}if(!k(t)){s=h(u,t,w)}}else{alert("`appendGrid` does not initialized")}}return s},getAllValue:function(v){var w=this,s=null,t;if(w.length>0){var u=e(w).data("appendGrid");if(u){s=v?{}:[];for(var x=0;x<u._rowOrder.length;x++){if(v){t=h(u,u._rowOrder[x],x);e.extend(s,t)}else{t=h(u,u._rowOrder[x]);s.push(t)}}if(v){s._RowCount=u._rowOrder.length}}}return s},getCtrlValue:function(s,v){var t=this;if(t.length>0){settings=t.data("appendGrid");if(settings&&v>=0&&v<settings._rowOrder.length){for(var u=0;u<settings.columns.length;u++){if(settings.columns[u].name===s){return c(settings,u,settings._rowOrder[v])}}}}return null},setCtrlValue:function(t,y,v){var w=this;if(w.length>0){var s=this,u=e(this).data("appendGrid");if(u&&y>=0&&y<u._rowOrder.length){for(var x=0;x<u.columns.length;x++){if(u.columns[x].name==t){l(u,x,u._rowOrder[y],v);break}}}}return w},getCellCtrl:function(u,t){var v=this,s=null;if(v.length==1){settings=v.data("appendGrid");if(!settings){alert("`appendGrid` does not initialized")}else{for(var w=0;w<settings.columns.length;w++){if(settings.columns[w].name===u){return p(settings.columns[w].type,settings.idPrefix,u,t);break}}}}return null},getCellCtrlByRowIndex:function(u,x){var v=this,s=null;if(v.length==1){settings=v.data("appendGrid");if(!settings){alert("`appendGrid` does not initialized")}else{if(x>=0&&x<settings._rowOrder.length){var t=settings._rowOrder[x];for(var w=0;w<settings.columns.length;w++){if(settings.columns[w].name===u){return p(settings.columns[w].type,settings.idPrefix,u,t)}}}}}return null},setCellCtrlByRowIndex:function(u,y,v){var w=this,s=null;if(w.length==1){settings=w.data("appendGrid");if(!settings){alert("`appendGrid` does not initialized")}else{if(y>=0&&y<settings._rowOrder.length){var t=settings._rowOrder[y];for(var x=0;x<settings.columns.length;x++){if(settings.columns[x].name===u){return setCellCtrl(settings.columns[x].type,settings.idPrefix,u,t,v)}}}}}return null},getRowOrder:function(){var u=this,s=null;if(this.length==1){var t=u.data("appendGrid");if(t){s=t._rowOrder.slice()}else{alert("`appendGrid` does not initialized")}}else{alert("Cannot get values on multiple grid")}return s}};function d(H,w,G,D){var L=e(H).data("appendGrid");var K=[],s=null,t,E,I=[];var u=H.getElementsByTagName("thead")[0];var B=H.getElementsByTagName("tbody")[0];if(e.isNumeric(D)){for(var A=0;A<L._rowOrder.length;A++){if(L._rowOrder[A]==D){G=A;if(A!=0){s=A-1}break}}}else{if(e.isNumeric(G)){if(G>=L._rowOrder.length){G=null}else{s=G-1}}else{if(L._rowOrder.length!=0){G=null;s=L._rowOrder.length-1}}}for(var A=0;A<w;A++){L._uniqueIndex++;t=L._uniqueIndex;I.length=0;if(e.isNumeric(G)){L._rowOrder.splice(G,0,t);tbRow=B.insertRow(G);K.push(G)}else{L._rowOrder.push(t);tbRow=B.insertRow(-1);K.push(L._rowOrder.length-1)}tbRow.id=L.idPrefix+"_Row_"+t;tbCell=tbRow.insertCell(-1);e(tbCell).addClass("ui-widget-content first").text(L._rowOrder.length).data("appendGrid",t);for(var C=0;C<L.columns.length;C++){if(L.columns[C].type=="hidden"){I.push(C);continue}tbCell=tbRow.insertCell(-1);tbCell.className="ui-widget-content";if(L.columns[C].cellCss!=null){e(tbCell).css(L.columns[C].cellCss)}E=null;if(L.columns[C].type=="custom"){if(typeof(L.columns[C].customBuilder)=="function"){E=L.columns[C].customBuilder(tbCell,L.idPrefix,L.columns[C].name,t)}}else{if(L.columns[C].type=="select"){E=document.createElement("select");E.id=L.idPrefix+"_"+L.columns[C].name+"_"+t;E.name=E.id;if(e.isArray(L.columns[C].ctrlOptions)){if(L.columns[C].ctrlOptions.length>0){if(e.isPlainObject(L.columns[C].ctrlOptions[0])){for(var F=0;F<L.columns[C].ctrlOptions.length;F++){E.options[E.options.length]=new Option(L.columns[C].ctrlOptions[F].label,L.columns[C].ctrlOptions[F].value)}}else{for(var F=0;F<L.columns[C].ctrlOptions.length;F++){E.options[E.options.length]=new Option(L.columns[C].ctrlOptions[F],L.columns[C].ctrlOptions[F])}}}}else{if(e.isPlainObject(L.columns[C].ctrlOptions)){for(var F in L.columns[C].ctrlOptions){E.options[E.options.length]=new Option(L.columns[C].ctrlOptions[F],F)}}else{if(typeof(L.columns[C].ctrlOptions)=="string"){var J=L.columns[C].ctrlOptions.split(";");for(var F=0;F<J.length;F++){var M=J[F].indexOf(":");if(-1==M){E.options[E.options.length]=new Option(J[F],J[F])}else{E.options[E.options.length]=new Option(J[F].substring(M+1,J[F].length),J[F].substring(0,M))}}}}}tbCell.appendChild(E)}else{if(L.columns[C].type=="checkbox"){E=document.createElement("input");E.type="checkbox";E.id=L.idPrefix+"_"+L.columns[C].name+"_"+t;E.name=E.id;E.value=1;tbCell.appendChild(E);tbCell.style.textAlign="center"}else{if(-1!=L.columns[C].type.search(/^(color|date|datetime|datetime\-local|email|month|number|range|search|tel|time|url|week)$/)){E=document.createElement("input");try{E.type=L.columns[C].type}catch(v){}E.id=L.idPrefix+"_"+L.columns[C].name+"_"+t;E.name=E.id;tbCell.appendChild(E)}else{E=document.createElement("input");E.type="text";E.id=L.idPrefix+"_"+L.columns[C].name+"_"+t;E.name=E.id;tbCell.appendChild(E);if(L.columns[C].type=="ui-datepicker"){e(E).datepicker(L.columns[C].uiOption)}else{if(L.columns[C].type=="ui-spinner"){e(E).spinner(L.columns[C].uiOption)}else{if(L.columns[C].type=="ui-autocomplete"){e(E).autocomplete(L.columns[C].uiOption)}}}}}}}if(L.columns[C].type!="custom"){if(L.columns[C].ctrlAttr!=null){e(E).attr(L.columns[C].ctrlAttr)}if(L.columns[C].ctrlProp!=null){e(E).prop(L.columns[C].ctrlProp)}if(L.columns[C].ctrlCss!=null){e(E).css(L.columns[C].ctrlCss)}if(L.columns[C].ctrlClass!=null){e(E).addClass(L.columns[C].ctrlClass)}if(L.columns[C].uiTooltip){e(E).tooltip(L.columns[C].uiTooltip)}if(typeof(L.columns[C].onClick)=="function"){e(E).click({caller:H,callback:L.columns[C].onClick,uniqueIndex:t},function(x){x.data.callback(x,e(x.data.caller).appendGrid("getRowIndex",x.data.uniqueIndex))})}if(typeof(L.columns[C].onChange)=="function"){e(E).change({caller:H,callback:L.columns[C].onChange,uniqueIndex:t},function(x){x.data.callback(x,e(x.data.caller).appendGrid("getRowIndex",x.data.uniqueIndex))})}}if(!k(L.columns[C].value)){l(L,C,t,L.columns[C].value)}}tbCell=tbRow.insertCell(-1);tbCell.className="ui-widget-content last";e(tbCell).append(e("<button/>").addClass("insert").val(t).attr({id:L.idPrefix+"_Insert_"+t,type:"button",title:L.textResources.insert,tabindex:-1}).button({icons:{primary:"ui-icon-arrowreturnthick-1-w"},text:false}).click(function(){e(H).appendGrid("insertRow",1,null,this.value)}));e(tbCell).append(e("<button/>").addClass("delete").val(t).attr({id:L.idPrefix+"_Delete_"+t,type:"button",title:L.textResources.remove,tabindex:-1}).button({icons:{primary:"ui-icon-trash"},text:false}).click(function(){g(H,null,this.value,false)}));e(tbCell).append(e("<button/>").addClass("moveUp").val(t).attr({id:L.idPrefix+"_MoveUp_"+t,type:"button",title:L.textResources.moveUp,tabindex:-1}).button({icons:{primary:"ui-icon-arrowthick-1-n"},text:false}).click(function(){e(H).appendGrid("moveUpRow",null,this.value)}));e(tbCell).append(e("<button/>").addClass("moveDown").val(t).attr({id:L.idPrefix+"_MoveDown_"+t,type:"button",title:L.textResources.moveDown,tabindex:-1}).button({icons:{primary:"ui-icon-arrowthick-1-s"},text:false}).click(function(){e(H).appendGrid("moveDownRow",null,this.value)}));for(var C=0;C<I.length;C++){E=document.createElement("input");E.id=L.idPrefix+"_"+L.columns[I[C]].name+"_"+t;E.type="hidden";tbCell.appendChild(E)}}b(H,L);if(e.isNumeric(G)){if(typeof(L.afterRowInserted)=="function"){L.afterRowInserted(H,s,K)}}else{if(typeof(L.afterRowAppended)=="function"){L.afterRowAppended(H,s,K)}}return{addedRows:K,parentIndex:s,rowIndex:G}}function g(t,y,s,v){var u=e(t).data("appendGrid");var x=t.getElementsByTagName("tbody")[0];if(e.isNumeric(s)){for(var w=0;w<u._rowOrder.length;w++){if(u._rowOrder[w]==s){y=w;break}}}if(e.isNumeric(y)){if(v||typeof(u.beforeRowRemove)!="function"||u.beforeRowRemove(t,y)){u._rowOrder.splice(y,1);x.deleteRow(y);b(t,u);n(t,y);if(typeof(u.afterRowRemoved)=="function"){u.afterRowRemoved(t,y)}}}else{if(v||typeof(u.beforeRowRemove)!="function"||u.beforeRowRemove(t,u._rowOrder.length-1)){s=u._rowOrder.pop();x.deleteRow(-1);b(t,u);if(typeof(u.afterRowRemoved)=="function"){u.afterRowRemoved(t,null)}}}}function n(s,v){var t=e(s).data("appendGrid");for(var u=v;u<t._rowOrder.length;u++){e("#"+t.idPrefix+"_Row_"+t._rowOrder[u]+" td.first",s).text(u+1)}}function a(y,u,x){var C,w,t,z,B;var v=e(y).data("appendGrid");if(v){C=y.getElementsByTagName("tbody")[0];e(C).empty();v._rowOrder.length=0;v._uniqueIndex=0;if(u!=null&&u.length){B=d(y,u.length,null,null);for(var s=0;s<B.addedRows.length;s++){for(var A=0;A<v.columns.length;A++){l(v,A,v._rowOrder[s],u[s][v.columns[A].name])}}}v._isDataLoaded=true;if(x){v.initData=null}e(y).data("appendGrid",v);if(typeof(v.dataLoaded)=="function"){v.dataLoaded(y)}}}function f(s,t){for(var u=0;u<t._rowOrder.length;u++){if(t._rowOrder[u]==s){return u}}return null}function k(s){return typeof(s)=="undefined"||s==null}function q(t,s){if(!k(t)&&e.isPlainObject(t)&&!k(t[s])){return t[s]}return null}function b(s,t){e(s).data("appendGrid",t);e("#"+t.idPrefix+"_rowOrder",s).val(t._rowOrder.join())}function r(t,s){var v=null;for(var u=0;u<t._rowOrder.length;u++){if(t._rowOrder[u]==s){return u}}return v}function h(v,t,x){var s={},u=null;for(var w=0;w<v.columns.length;w++){u=v.columns[w].name+(k(x)?"":"_"+x);s[u]=c(v,w,t)}return s}function c(w,u,s){var x=null,v=w.columns[u].type,t=w.columns[u].name;if(v=="checkbox"){x=p(v,w.idPrefix,t,s);if(x==null){return null}else{return x.checked?1:0}}else{if(v=="custom"){if(typeof(w.columns[u].customGetter)=="function"){return w.columns[u].customGetter(w.idPrefix,t,s)}else{return null}}else{x=p(v,w.idPrefix,t,s);if(x==null){return null}else{return x.value}}}}function p(u,v,t,s){return document.getElementById(v+"_"+t+"_"+s)}function l(w,u,s,x){var v=w.columns[u].type;var t=w.columns[u].name;if(v=="checkbox"){p(v,w.idPrefix,t,s).checked=(x!=null&&x!=0)}else{if(v=="custom"){if(typeof(w.columns[u].customSetter)=="function"){w.columns[u].customSetter(w.idPrefix,t,s,x)}}else{p(v,w.idPrefix,t,s).value=(x==null?"":x)}}}e.fn.appendGrid=function(s){if(i[s]){return i[s].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof(s)==="object"||!s){return i.init.apply(this,arguments)}else{e.error("`"+s+"` method does not supported by appendGrid...")}}}})(jQuery);